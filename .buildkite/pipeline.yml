agents:
  provider: "gcp"
steps:
  - label: ":buildkite: Check"
    command:
      - ".buildkite/scripts/check.sh"
    plugins:
      - golang#v2.0.0:
          version: 1.20.5
          import: github.com/elastic/assetbeat
  - label: ":buildkite: Build"
    command:
      - ".buildkite/scripts/build.sh"
    plugins:
      - golang#v2.0.0:
          version: 1.20.5
          import: github.com/elastic/assetbeat
  - label: ":buildkite: Test"
    command:
      - ".buildkite/scripts/test.sh"
    plugins:
      - golang#v2.0.0:
          version: 1.20.5
          import: github.com/elastic/assetbeat
  - label: ":package: Package Assetbeat - Snapshot"
    key: "package-snapshot"
    command: "./.buildkite/scripts/package.sh snapshot"
    artifact_paths: "build/distributions/*"
    plugins:
      - golang#v2.0.0:
          version: 1.20.5
          import: github.com/elastic/assetbeat
  - label: ":rocket: Publishing Snapshot DRA artifacts"
    if: build.branch == 'main'
    depends_on: "package-snapshot"
    command: "./.buildkite/scripts/publish.sh snapshot"